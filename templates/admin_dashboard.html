<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard - ComLabs</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
<link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">

<style>

@keyframes fadeIn { from { opacity:0;} to {opacity:1;} }

:root {
    --primary:#007bff;
    --success:#28a745;
    --danger:#dc3545;
    --warning:#ffc107;
    --gray:#6c757d;
}

body{
    font-family:'Segoe UI',sans-serif;
    background:#f5f7fa;
    margin:0;
    padding:0;
    text-align:center;
}

/* Top Bar styles removed - using sidebar.css styles from topbar.html component */

/* Legacy notification styles removed - using alerts.js system */

/* ACTION BUTTONS */
.action-area{
    margin-bottom:35px;display:flex;justify-content:center;gap:15px;
    flex-wrap:wrap;
    padding:0 20px;
}
.action-btn{
    padding:12px 22px;font-weight:600;border-radius:12px;border:none;
    cursor:pointer;transition:0.25s;box-shadow:0 3px 10px rgba(0,0,0,0.18);
    display:flex;align-items:center;gap:8px;
    min-height:44px;
}
.action-btn.add{background:var(--success);color:white;}
.action-btn.add:hover{background:#1f8a37;}

.action-btn.edit{background:var(--warning);color:white;}
.action-btn.edit:hover{background:#e0a800;}

@media (max-width: 576px) {
    .action-area {
        flex-direction:column;
    }
    .action-btn {
        width:100%;
        justify-content:center;
    }
}

/* GRID */
.grid{
    display:grid;
    grid-template-columns:1fr;
    gap:20px;
    max-width:1200px;
    margin:0 auto;
    padding:0 20px;
}

@media (min-width: 576px) {
    .grid {
        grid-template-columns:repeat(2,1fr);
        gap:25px;
    }
}

@media (min-width: 768px) {
    .grid {
        grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
        gap:30px;
    }
}

@media (min-width: 1024px) {
    .grid {
        gap:38px;
    }
}
.comlab-box{
    background:white;border-radius:18px;padding:32px 20px 85px;
    position:relative;transition:0.35s;
    box-shadow:0 6px 20px rgba(0,0,0,0.12);
}
.comlab-box:hover{
    transform:translateY(-8px);
    box-shadow:0 12px 32px rgba(0,0,0,0.22);
}

.comlab-box img{
    width:75%;margin-bottom:18px;filter:drop-shadow(0 5px 6px rgba(0,0,0,0.18));
}
.comlab-box p{margin:0;font-size:17px;font-weight:600;color:#2b2b2b;}

.go-btn{
    position:absolute;bottom:18px;left:50%;transform:translateX(-50%);
    padding:10px 20px;background:var(--primary);color:white;
    border:none;border-radius:10px;cursor:pointer;font-weight:600;
    opacity:0;transition:0.35s;
}
.comlab-box:hover .go-btn{
    opacity:1;transform:translate(-50%,-4px);
}

/* EDIT MODE */
.edit-actions{
    position:absolute;bottom:18px;left:50%;transform:translateX(-50%);display:flex;gap:10px;
}
.edit-btn{
    padding:10px;border:none;border-radius:10px;cursor:pointer;
    width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:1.2em;
}
.edit-btn.rename{background:var(--warning);}
.edit-btn.remove{background:var(--danger);color:white;}
.edit-btn.cancel{background:var(--gray);color:white;}

/* Modal Styles */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    justify-content: center;
    align-items: center;
}

.modal-overlay.active {
    display: flex;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    max-width: 500px;
    width: 90%;
    text-align: center;
    position: relative;
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.2s;
}

.modal-close:hover {
    background: #f0f0f0;
}

.modal-content h2 {
    color: var(--primary);
    margin-bottom: 15px;
    margin-top: 0;
}

.modal-content p {
    color: #555;
    margin-bottom: 20px;
}

.modal-content input {
    width: 100%;
    padding: 12px;
    margin-bottom: 20px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 14px;
    text-align: center;
    font-family: monospace;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.modal-btn {
    padding: 12px 25px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s, background 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.modal-btn:hover {
    transform: scale(1.05);
}

.modal-btn-primary {
    background-color: var(--primary);
    color: white;
}

.modal-btn-primary:hover {
    background-color: #0056b3;
}

.modal-btn-secondary {
    background-color: var(--success);
    color: white;
}

.modal-btn-secondary:hover {
    background-color: #1e7e34;
}

.modal-btn-tertiary {
    background-color: var(--warning);
    color: white;
}

.modal-btn-tertiary:hover {
    background-color: #e0a800;
}

</style>
</head>
<body>
    <!-- Sidebar -->
    {% set current_page = 'admin_dashboard' %}
    {% include 'includes/sidebar.html' %}

    <!-- Main Content Wrapper -->
    <div class="main-content-wrapper">
        <!-- Top Bar -->
        {% include 'includes/topbar.html' %}
        {% block topbar_actions %}
        <button onclick="openAddDeviceModal()" class="btn-responsive" style="background:#28a745;color:white;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:600;min-height:44px;"><i class="fas fa-plus"></i> <span class="hide-mobile">Add Device</span></button>
        {% endblock %}

        <!-- Page Content -->
        <div class="page-content">
            <!-- Mobile/Tablet Title will be inserted here by topbar.html -->

<div class="action-area">
    <button class="action-btn add" onclick="addLab()"><i class="fas fa-plus"></i> Add Computer Lab</button>
    <button class="action-btn edit" onclick="editLab()"><i class="fas fa-edit"></i> Edit / Remove</button>
</div>

<div class="grid">
{% for lab in labs %}
    <div class="comlab-box">
        <img src="https://its.lmu.edu/media/its/computer%20lab%20icon-400x400.png">
        <p>{{ lab[1] }}</p>

        {% if not edit_mode %}
        <button class="go-btn" onclick="location.href='/comlab/{{ lab[0] }}/inventory'">Enter <i class="fa fa-arrow-right"></i></button>
        {% else %}
        <div class="edit-actions">
            <button class="edit-btn rename" onclick="renameLab({{ lab[0] }}, '{{ lab[1] }}')"><i class="fas fa-pencil-alt"></i></button>
            <button class="edit-btn remove" onclick="removeLab({{ lab[0] }})"><i class="fas fa-trash-alt"></i></button>
            <button class="edit-btn cancel" onclick="location.href='/admin'"><i class="fas fa-times"></i></button>
        </div>
        {% endif %}
    </div>
{% endfor %}
        </div>
        </div>
    </div>

<!-- Add Device Modal -->
<div id="addDeviceModal" class="modal-overlay">
    <div class="modal-content">
        <button class="modal-close" onclick="closeAddDeviceModal()">&times;</button>
        <h2>ðŸ”— Device Registration Link</h2>
        <p>Copy and open this link on the device you want to register:</p>
        <input type="text" id="deviceLink" readonly>
        <div class="modal-buttons">
            <button class="modal-btn modal-btn-primary" onclick="copyLink()">
                <i class="fas fa-copy"></i> Copy Link
            </button>
            <button class="modal-btn modal-btn-tertiary" onclick="openLinkInNewTab()">
                <i class="fas fa-external-link-alt"></i> Open in New Tab
            </button>
            <button class="modal-btn modal-btn-secondary" onclick="closeAddDeviceModal()">
                <i class="fas fa-check"></i> Done
            </button>
        </div>
    </div>
</div>

<script>
// Legacy notification system removed - using new alerts.js system
</script>

<script>
function addLab(){
    const name = prompt("Enter Lab Name:");
    if(!name) return;
    fetch("/add_lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lab_name:name})})
    .then(r=>r.json()).then(d=>{alert(d.message);location.reload();});
}

function editLab(){ location.href="/admin?edit=1"; }

function renameLab(id,currentName){
    const newName=prompt("Rename Lab:",currentName);
    if(!newName||!newName.trim())return;
    fetch("/rename_lab",{method:"POST",headers:{"Content-Type":"application/json"},
        body:JSON.stringify({id:id,new_name:newName})})
    .then(r=>r.json()).then(d=>{alert(d.message);location.reload();});
}

function removeLab(id){
    if(!confirm("Are you sure you want to delete this lab?"))return;
    fetch("/remove_lab",{method:"POST",headers:{"Content-Type":"application/json"},
        body:JSON.stringify({id:id})})
    .then(r=>r.json()).then(d=>{alert(d.message);location.reload();});
}

function openAddDeviceModal() {
    // Generate link via API
    fetch('/generate_link')
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                document.getElementById('deviceLink').value = data.link;
                document.getElementById('addDeviceModal').classList.add('active');
            } else {
                alert('Failed to generate link. Please try again.');
            }
        })
        .catch(err => {
            console.error(err);
            alert('Error generating link. Please try again.');
        });
}

function closeAddDeviceModal() {
    document.getElementById('addDeviceModal').classList.remove('active');
}

function copyLink() {
    const linkInput = document.getElementById('deviceLink');
    linkInput.select();
    linkInput.setSelectionRange(0, 99999); // For mobile devices
    navigator.clipboard.writeText(linkInput.value).then(() => {
        alert('âœ… Link copied to clipboard!');
    }).catch(() => {
        // Fallback for older browsers
        document.execCommand('copy');
        alert('âœ… Link copied to clipboard!');
    });
}

function openLinkInNewTab() {
    const linkInput = document.getElementById('deviceLink');
    const link = linkInput.value;
    if (link) {
        window.open(link, '_blank');
    } else {
        alert('No link available to open.');
    }
}

// Close modal when clicking outside
document.getElementById('addDeviceModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeAddDeviceModal();
    }
});
</script>

<script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
<script src="{{ url_for('static', filename='js/topbar-menu.js') }}"></script>
{% if current_user and current_user.get('role') == 'admin' %}
<script src="{{ url_for('static', filename='js/alerts.js') }}"></script>
{% endif %}
</body>
</html>
