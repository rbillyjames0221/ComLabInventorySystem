<aside class="sidebar" id="sidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
        <div class="sidebar-logo">
            <i class="fas fa-desktop"></i>
            <span class="sidebar-title">Inventory System</span>
        </div>
        <!-- Mobile Menu Toggle Button (only visible on mobile) -->
        <button class="sidebar-mobile-toggle" id="sidebarMobileToggle" aria-label="Close sidebar">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Sidebar Menu -->
    <nav class="sidebar-menu">
        <ul class="menu-list">
            {% if current_user and current_user.get('role') == 'admin' %}
                <!-- Admin Menu -->
                
                <!-- Dashboard -->
                <li class="menu-item">
                    <a href="/admin" class="menu-link {% if current_page == 'admin_dashboard' %}active{% endif %}">
                        <i class="fas fa-home"></i>
                        <span class="menu-text">Dashboard</span>
                    </a>
                </li>

                <!-- User Management -->
                <li class="menu-item has-children">
                    <a href="#" class="menu-link" onclick="toggleSubmenu(this); return false;">
                        <i class="fas fa-users-cog"></i>
                        <span class="menu-text">User Management</span>
                        <i class="fas fa-chevron-down menu-arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="/account-management" class="submenu-link {% if current_page == 'account_management' %}active{% endif %}">
                                <i class="fas fa-user-cog"></i>
                                <span>Account Management</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" onclick="openPendingModal(); return false;">
                                <i class="fas fa-user-clock"></i>
                                <span>Pending Accounts</span>
                                {% if pending_accounts_count and pending_accounts_count > 0 %}
                                <span class="menu-badge">{{ pending_accounts_count }}</span>
                                {% endif %}
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" onclick="openProfileEditsModal(); return false;">
                                <i class="fas fa-user-edit"></i>
                                <span>Pending Profile Edits</span>
                                {% if pending_edits_count and pending_edits_count > 0 %}
                                <span class="menu-badge">{{ pending_edits_count }}</span>
                                {% endif %}
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- Device Management -->
                <li class="menu-item has-children">
                    <a href="#" class="menu-link" onclick="toggleSubmenu(this); return false;">
                        <i class="fas fa-desktop"></i>
                        <span class="menu-text">Device Management</span>
                        <i class="fas fa-chevron-down menu-arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="/unregistered_devices" class="submenu-link {% if current_page == 'unregistered_devices' %}active{% endif %}">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Unregistered Devices</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="/register_device" class="submenu-link {% if current_page == 'register_device' %}active{% endif %}">
                                <i class="fas fa-plus-circle"></i>
                                <span>Register Device</span>
                            </a>
                        </li>
                        {% if comlab_id %}
                        <li class="submenu-item">
                            <a href="/comlab/{{ comlab_id }}/devices" class="submenu-link {% if current_page == 'comlab_view' %}active{% endif %}">
                                <i class="fas fa-list"></i>
                                <span>Device List</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </li>

                <!-- Computer Labs -->
                <li class="menu-item has-children">
                    <a href="#" class="menu-link" onclick="toggleSubmenu(this); return false;">
                        <i class="fas fa-building"></i>
                        <span class="menu-text">Computer Labs</span>
                        <i class="fas fa-chevron-down menu-arrow"></i>
                    </a>
                    <ul class="submenu">
                        {% if labs %}
                            {% for lab in labs %}
                            <li class="submenu-item">
                                <a href="/comlab/{{ lab[0] }}/inventory" class="submenu-link {% if comlab_id == lab[0] %}active{% endif %}">
                                    <i class="fas fa-laptop"></i>
                                    <span>{{ lab[1] }}</span>
                                </a>
                            </li>
                            {% endfor %}
                        {% endif %}
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" onclick="addLab(); return false;">
                                <i class="fas fa-plus"></i>
                                <span>Add New Lab</span>
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- Inventory Management (Context-aware) -->
                {% if comlab_id %}
                <li class="menu-item has-children">
                    <a href="#" class="menu-link" onclick="toggleSubmenu(this); return false;">
                        <i class="fas fa-clipboard-list"></i>
                        <span class="menu-text">Inventory</span>
                        <i class="fas fa-chevron-down menu-arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li class="submenu-item">
                            <a href="/comlab/{{ comlab_id }}/inventory/view_summary" class="submenu-link {% if current_page == 'view_summary' %}active{% endif %}">
                                <i class="fas fa-chart-pie"></i>
                                <span>View Summary</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="/comlab/{{ comlab_id }}/inventory/view_alerts" class="submenu-link {% if current_page == 'view_alerts' %}active{% endif %}">
                                <i class="fas fa-bell"></i>
                                <span>View Alerts</span>
                                {% if alerts_count and alerts_count > 0 %}
                                <span class="menu-badge">{{ alerts_count }}</span>
                                {% endif %}
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="/comlab/{{ comlab_id }}/inventory/peripheral_summary" class="submenu-link {% if current_page == 'peripheral_summary' %}active{% endif %}">
                                <i class="fas fa-list-alt"></i>
                                <span>Peripheral Summary</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="/comlab/{{ comlab_id }}/inventory/usb_devices" class="submenu-link {% if current_page == 'usb_devices' %}active{% endif %}">
                                <i class="fas fa-usb"></i>
                                <span>USB Devices</span>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="/comlab/{{ comlab_id }}/inventory/view_reports" class="submenu-link {% if current_page == 'view_reports' %}active{% endif %}">
                                <i class="fas fa-file-alt"></i>
                                <span>Reports</span>
                            </a>
                        </li>
                    </ul>
                </li>
                {% endif %}

                <!-- Settings -->
                <li class="menu-item">
                    <a href="/settings" class="menu-link {% if current_page == 'settings' %}active{% endif %}">
                        <i class="fas fa-cog"></i>
                        <span class="menu-text">Settings</span>
                    </a>
                </li>

            {% else %}
                <!-- Student Menu -->
                
                <!-- Dashboard -->
                <li class="menu-item">
                    <a href="/user/dashboard" class="menu-link {% if current_page == 'student_dashboard' %}active{% endif %}">
                        <i class="fas fa-home"></i>
                        <span class="menu-text">Dashboard</span>
                    </a>
                </li>

                <!-- Profile -->
                <li class="menu-item">
                    <a href="#" class="menu-link" onclick="openModal('profileModal'); return false;">
                        <i class="fas fa-user"></i>
                        <span class="menu-text">Profile</span>
                    </a>
                </li>

            {% endif %}
        </ul>
    </nav>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
        <a href="{% if current_user and current_user.get('role') == 'admin' %}/logout{% else %}/user/logout{% endif %}" class="menu-link logout-link">
            <i class="fas fa-sign-out-alt"></i>
            <span class="menu-text">Logout</span>
        </a>
    </div>
</aside>

<!-- Mobile Overlay -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<script>
// Helper functions for sidebar interactions
function toggleSubmenu(element) {
    const menuItem = element.closest('.menu-item');
    const submenu = menuItem.querySelector('.submenu');
    
    if (submenu) {
        menuItem.classList.toggle('open');
        const arrow = element.querySelector('.menu-arrow');
        if (arrow) {
            arrow.style.transform = menuItem.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
        }
    }
}

// Open pending accounts modal (if exists on page)
function openPendingModal() {
    const pendingBtn = document.getElementById('pendingBtn');
    if (pendingBtn) {
        pendingBtn.click();
    } else {
        window.location.href = '/account-management';
    }
}

// Open profile edits modal (if exists on page)
function openProfileEditsModal() {
    const profileEditsBtn = document.getElementById('profileEditsBtn');
    if (profileEditsBtn) {
        profileEditsBtn.click();
    } else {
        window.location.href = '/account-management';
    }
}

// Add lab function (if exists on page)
function addLab() {
    if (typeof window.addLab === 'function') {
        window.addLab();
    } else {
        const name = prompt("Enter Lab Name:");
        if (!name) return;
        fetch("/add_lab", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({lab_name: name})
        })
        .then(r => r.json())
        .then(d => {
            alert(d.message);
            location.reload();
        });
    }
}
</script>

